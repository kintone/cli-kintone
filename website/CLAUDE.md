# cli-kintone Documentation Website

This directory contains the Docusaurus-based documentation website for cli-kintone.

## Overview

- **Framework**: Docusaurus 3.9.2
- **Languages**: English (en) and Japanese (ja)
- **Default Language**: English
- **Node Version**: >=18.0

## Project Structure

```
website/
├── docs/                      # English documentation (source)
│   ├── guide/                 # User guide
│   ├── reference/             # API reference
│   └── community/             # Community docs
├── i18n/
│   ├── en/                    # English UI translations
│   └── ja/                    # Japanese translations
│       ├── code.json          # Theme UI translations (140 items)
│       ├── docusaurus-theme-classic/
│       │   ├── navbar.json    # Navigation bar (7 items)
│       │   └── footer.json    # Footer (12 items)
│       ├── docusaurus-plugin-content-blog/
│       │   └── options.json   # Blog settings (3 items)
│       ├── docusaurus-plugin-content-docs/
│       │   ├── current.json   # Sidebar translations
│       │   └── current/       # Translated documentation (13 files, Guide section only)
│       │       └── guide/     # 13 files
├── blog/                      # Blog posts (8 files with truncate markers)
├── src/                       # React components and custom pages
├── static/                    # Static assets
├── docusaurus.config.ts       # Main configuration
├── sidebars.ts               # Sidebar configuration
└── package.json              # Dependencies and scripts
```

## Commands

### Development

```bash
# Start dev server (both languages)
pnpm start

# Start dev server (Japanese only)
pnpm start:ja
# or
pnpm start --locale ja

# Start dev server (custom port)
pnpm start --port 3001
```

### Build

```bash
# Build for production (all languages)
pnpm build

# Serve production build
pnpm serve
```

### i18n

```bash
# Generate translation files for Japanese
pnpm write-translations --locale ja
```

### Utilities

```bash
# Update contributor credits
pnpm update-credits

# Update translation progress percentage
pnpm update-translation-progress
```

## Configuration

### Main Config (`docusaurus.config.ts`)

Key configuration points:

1. **i18n Setup** (lines 35-46):

   ```typescript
   i18n: {
     defaultLocale: "en",
     locales: ["en", "ja"],
     localeConfigs: {
       en: {
         label: "English",
       },
       ja: {
         label: "日本語 (28%)",  // Translation progress percentage
       },
     },
   }
   ```

   - Japanese locale label shows translation progress percentage
   - Use `pnpm update-translation-progress` to update the percentage

2. **Markdown Hooks** (lines 26-30):

   ```typescript
   markdown: {
     hooks: {
       onBrokenMarkdownLinks: "warn",
     },
   }
   ```

   - Migrated from deprecated `onBrokenMarkdownLinks` config

3. **Blog Settings** (lines 64-68):
   ```typescript
   blog: {
     showReadingTime: true,
     editUrl: "https://github.com/kintone/cli-kintone/tree/main/website",
   }
   ```

   - All blog posts have `<!-- truncate -->` markers

4. **Google Tag Manager** (lines 72-74):
   ```typescript
   googleTagManager: {
     containerId: "GTM-5N49D3",
   }
   ```

5. **Algolia Search** (lines 181-186):
   ```typescript
   algolia: {
     appId: "JRU2EW1Y0Z",
     apiKey: "1f783c5faa4d2cca91a435ae227cc48f",
     indexName: "cli",
     contextualSearch: true,
   }
   ```

6. **SASS/SCSS Support** (line 188):
   ```typescript
   plugins: ["docusaurus-plugin-sass"]
   ```

   - Custom CSS uses SCSS: `src/css/custom.scss`

### Sidebars (`sidebars.ts`)

Uses autogenerated sidebars for three sections:

- `guideSidebar` - Generated from `docs/guide/`
- `referenceSidebar` - Generated from `docs/reference/`
- `communitySidebar` - Generated from `docs/community/`

## Important: Sidebar Duplicate Keys

⚠️ **Critical**: Two files have unique `sidebar_key` to avoid conflicts:

1. `docs/reference/record-export/fields/index.md`:

   ```yaml
   ---
   sidebar_label: Field specifications
   sidebar_key: record-export-field-specifications
   ---
   ```

2. `docs/reference/record-import/fields/index.md`:
   ```yaml
   ---
   sidebar_label: Field specifications
   sidebar_key: record-import-field-specifications
   ---
   ```

**DO NOT REMOVE** these `sidebar_key` attributes or the build will fail with duplicate translation key errors.

## i18n File Paths

### Component Imports in Translated Files

For translated files in `i18n/ja/docusaurus-plugin-content-docs/current/`, use absolute paths:

❌ Wrong:

```javascript
import Author from "../../src/components/credits/Author";
```

✅ Correct:

```javascript
import Author from "@site/src/components/credits/Author";
```

### Images in Translated Files

For images referenced in translated markdown files, copy the image to the same relative location in the i18n directory structure.

Example:

- Original: `docs/guide/commands/img/localeDropdown.png`
- Japanese: `i18n/ja/docusaurus-plugin-content-docs/current/guide/commands/img/localeDropdown.png`

**Note**: Currently only the Guide section is translated, so this mainly applies to guide documentation.

## Markdown Links

### Internal Links Format

Use `.md` extension for internal documentation links:

✅ Correct:

```markdown
[Stability Index](./stability-index.md)
```

❌ Wrong (will cause broken links):

```markdown
[Stability Index](./stability-index)
```

Docusaurus requires the `.md` extension for proper link resolution in i18n versions, even though it generates warnings.

## Known Warnings (Safe to Ignore)

### 1. Markdown Link Warnings

```
[WARNING] Markdown link with URL `./stability-index.md` couldn't be resolved.
```

**Status**: Safe to ignore
**Reason**: Docusaurus is strict about link resolution in i18n files, but the links work correctly in the built site.
**DO NOT** remove `.md` extensions to fix these warnings - it will break the links.

### 2. Broken Anchors

```
[WARNING] Docusaurus found broken anchors!
```

**Status**: Safe to ignore
**Reason**: Japanese page headings generate different anchor IDs (e.g., `#実験的` instead of `#experimental`). This doesn't affect functionality.

## Translation Workflow

### Adding New Documentation

1. Create English documentation in `docs/`
2. Build the site to test: `pnpm build`
3. Generate Japanese translation structure: `pnpm write-translations --locale ja`
4. Translate the content in `i18n/ja/docusaurus-plugin-content-docs/current/`
   - **Currently focusing on Guide section only**
5. For React components, use `@site/` alias for imports
6. For images, copy to the same relative path in i18n directory
7. Build again to verify: `pnpm build`
8. Update translation progress: `pnpm update-translation-progress`

### Blog Posts

All blog posts must include a `<!-- truncate -->` marker for proper preview generation. Place it after the introduction but before detailed content.

Example:

```markdown
---
title: My Post
---

Introduction paragraph here.

<!-- truncate -->

## Detailed Content

...
```

## Common Issues and Solutions

### Issue: Duplicate Sidebar Keys Error

**Error**:

```
Multiple docs sidebar items produce the same translation key.
- `sidebar.referenceSidebar.category.Field specifications`: 2 duplicates found
```

**Solution**: Ensure both field specification index files have unique `sidebar_key` attributes (see "Sidebar Duplicate Keys" section above).

### Issue: Component Import Errors in i18n Files

**Error**:

```
Module not found: Error: Can't resolve '../../src/components/credits/Author'
```

**Solution**: Use `@site/` alias instead of relative paths:

```javascript
import Author from "@site/src/components/credits/Author";
```

### Issue: Image Not Found in i18n Files

**Error**:

```
Markdown image with URL `./img/localeDropdown.png` couldn't be resolved
```

**Solution**: Copy the image to the corresponding location in the i18n directory:

```bash
mkdir -p i18n/ja/docusaurus-plugin-content-docs/current/guide/commands/img
cp docs/guide/commands/img/localeDropdown.png \
   i18n/ja/docusaurus-plugin-content-docs/current/guide/commands/img/
```

### Issue: Broken Links After Removing `.md` Extension

**Problem**: Removing `.md` from links causes build failures.

**Solution**: Keep the `.md` extension in markdown links. The warnings are cosmetic and don't affect functionality.

## Build Output

Successful build produces:

- `build/` - English version
- `build/ja/` - Japanese version

Access URLs:

- English: `http://localhost:3000/`
- Japanese: `http://localhost:3000/ja/`

## Translation Statistics

Current translation progress: **28%**

- **UI Components**: 162 items translated
- **Documentation Files**: **13 files translated (Guide section only)**
  - Guide section: 13 files ✓
  - Reference section: Not yet translated
  - Community section: Not yet translated
- **Blog Posts**: 8 posts with truncate markers

**Note**: Translation effort is currently focused on the Guide section only. Reference and Community sections remain in English.

## Links

- [Production Site](https://cli.kintone.dev/)
- [GitHub Repository](https://github.com/kintone/cli-kintone)
- [Docusaurus Documentation](https://docusaurus.io/)

## Notes for AI Assistants

1. **Translation scope**: Currently only the **Guide section** is translated to Japanese. Reference and Community sections remain English-only.
2. **Never remove `sidebar_key` attributes** from the field specification files
3. **Always use `@site/` alias** for component imports in i18n files
4. **Keep `.md` extensions** in internal documentation links
5. **Don't try to fix** markdown link warnings by removing extensions
6. **Copy images** to i18n directories when translating docs with images (mainly guide section)
7. **Use `<!-- truncate -->` markers** in all new blog posts
8. **Test builds** for both English and Japanese locales before committing
9. **Update translation progress** using `pnpm update-translation-progress` after adding translations
